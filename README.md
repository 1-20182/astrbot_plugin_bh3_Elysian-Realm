# 崩坏3乐土攻略插件 (astrbot_plugin_bh3)

适用于 AstrBot 的崩坏3往事乐土攻略查询插件，支持查询角色乐土攻略图片，并具备自动检测和更新攻略资源的功能。

## 功能特点

- 🔍 **角色攻略查询** - 支持通过角色名或别名查询乐土攻略
- 🏷️ **智能别名匹配** - 支持多种别名，如"人律"、"爱莉"都能查到爱莉希雅
- 🖼️ **图片自动匹配** - 自动查找并发送对应角色的攻略图片
- 📥 **资源在线更新** - 支持从 GitHub 拉取最新攻略图片资源
- 🤖 **自动检测更新** - 自动检测仓库更新并自动更新图片库
- ⚙️ **灵活配置** - 支持自定义检查间隔和开关自动更新
- ⚡ **轻量高效** - 基于 AstrBot 框架开发，响应快速

## 安装方法

### 方式一：直接下载（推荐）

1. 下载本插件文件夹
2. 将文件夹复制到 AstrBot 的插件目录：`data/plugins/`
3. 重启 AstrBot 或在控制台执行 `plugin load` 加载插件

### 方式二：Git 克隆

```bash
cd AstrBot/data/plugins/
git clone https://github.com/your-repo/astrbot_plugin_bh3.git
```

## 使用方法

### 查询乐土攻略

```
/乐土攻略 <角色名>
```

**示例：**
- `/乐土攻略 爱莉希雅`
- `/乐土攻略 人律`
- `/乐土攻略 炎律`
- `/乐土攻略 雷律`

### 显示帮助信息

```
/乐土帮助
```

### 更新攻略资源（管理员）

```
/更新乐土攻略 [代理地址]
```

**示例：**
- `/更新乐土攻略` - 直接从 GitHub 更新
- `/更新乐土攻略 ghproxy` - 使用 ghproxy 代理更新
- `/更新乐土攻略 https://ghproxy.com` - 使用自定义代理

### 自动更新功能

#### 检查更新状态
```
/乐土更新状态
```
显示当前版本信息、自动更新状态和配置。

#### 手动检查更新
```
/检查乐土更新
```
手动检查远程仓库是否有新版本。

#### 开启/关闭自动更新
```
/乐土自动更新 <开启/关闭>
```

**示例：**
- `/乐土自动更新 开启` - 开启自动更新
- `/乐土自动更新 关闭` - 关闭自动更新

## 自动更新机制

### 工作原理

1. **定时检查** - 插件默认每小时检查一次远程仓库更新
2. **版本对比** - 通过 GitHub API 获取最新 commit hash，与本地保存的版本对比
3. **自动下载** - 检测到新版本时，自动克隆仓库并更新图片资源
4. **状态记录** - 更新成功后保存新版本号，避免重复更新

### 配置说明

自动更新配置保存在 `data/astrbot_plugin_bh3/auto_update.json`：

```json
{
  "check_interval": 3600,
  "auto_update": true,
  "notify_admin": true
}
```

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `check_interval` | 检查间隔（秒） | 3600（1小时） |
| `auto_update` | 是否开启自动更新 | true |
| `notify_admin` | 更新后是否通知管理员 | true |

### 版本记录

版本信息保存在 `data/astrbot_plugin_bh3/version.json`：

```json
{
  "commit_hash": "abc123def456",
  "update_time": "2024-01-15T10:30:00"
}
```

## 支持的角色别名

插件支持丰富的角色别名，包括但不限于：

| 角色 | 支持的别名 |
|------|-----------|
| 人之律者 | 人律、爱律、爱莉希雅、爱莉 |
| 薪炎之律者 | 炎律、薪炎、琪亚娜 |
| 雷之律者 | 雷律、芽衣 |
| 理之律者 | 理律、摩托鸭、布洛妮娅 |
| 死生之律者 | 死律、希儿 |
| 终焉之律者 | 终焉 |
| 始源之律者 | 始源 |
| 真理之律者 | 真理、真律、真鸭 |
| 识之律者 | 识律、识宝、小识 |
| 天元骑英 | 天元、天鹅、呆鹅 |
| 羽兔 | 织羽梦旌、米丝忒琳 |
| 月下誓约 | 大月下、月下 |
| 瑟莉姆 | 瑟小姐、瑟瑟 |
| 松雀 | 曙影、小雀子 |
| 薇塔 | 小薇、孑遗千星 |
| 花火 | 花导、假面愚者 |
| ... | ... |

更多别名请查看 `alias.yaml` 文件。

## 攻略图片来源

- 攻略制作：[月光中心_official](https://space.bilibili.com/25289147)（米游社）
- 图片整合：[MskTmi/ElysianRealm-Data](https://github.com/MskTmi/ElysianRealm-Data)

## 文件结构

```
astrbot_plugin_bh3/
├── main.py              # 插件主文件
├── metadata.yaml        # 插件元数据
├── alias.yaml           # 角色别名配置
├── requirements.txt     # 依赖文件
├── README.md            # 本文件
└── resources/           # 攻略图片资源
    ├── Human.jpg
    ├── Elysia.jpg
    ├── Thunder.jpg
    └── ... (106张攻略图片)
```

## 依赖说明

本插件依赖以下 Python 库：

- `pyyaml` - 用于解析 YAML 配置文件

AstrBot 框架已内置的依赖：
- `aiohttp` - 异步 HTTP 请求
- `asyncio` - 异步协程支持

## 配置说明

### alias.yaml

角色别名配置文件，格式如下：

```yaml
Human:
  - 人之律者
  - 人律
  - 爱律
  - 爱莉希雅
  - 爱莉

Thunder:
  - 雷之律者
  - 雷律
```

您可以自行添加或修改别名配置。

## 更新日志

### v1.1.0
- ✨ 新增自动检测更新功能
- ✨ 新增自动下载更新功能
- ✨ 新增版本管理功能
- ✨ 新增 `/检查乐土更新` 命令
- ✨ 新增 `/乐土自动更新` 命令
- ✨ 新增 `/乐土更新状态` 命令

### v1.0.0
- ✨ 初始版本发布
- ✨ 支持角色攻略查询
- ✨ 支持别名匹配
- ✨ 支持资源在线更新
- ✨ 包含 106 张攻略图片

## 注意事项

1. **首次使用** - 插件已包含攻略图片，可直接使用
2. **自动更新** - 默认开启，每小时检查一次，可在配置中调整
3. **网络要求** - 自动更新需要连接 GitHub API，国内用户可能需要代理
4. **权限管理** - 更新资源命令仅限管理员使用
5. **版本记录** - 首次使用或手动更新后会自动记录版本号

## 常见问题

### Q: 自动更新失败怎么办？
A: 请检查网络连接，如果是国内网络可以尝试使用代理，或者手动执行 `/更新乐土攻略 ghproxy`

### Q: 如何关闭自动更新？
A: 使用命令 `/乐土自动更新 关闭` 即可关闭

### Q: 如何查看当前版本？
A: 使用命令 `/乐土更新状态` 可以查看本地和远程版本信息

### Q: 新角色发布了如何更新？
A: 插件会自动检测并下载新角色的攻略图片，也可以手动执行 `/更新乐土攻略` 立即更新

## 问题反馈

如遇到问题或有功能建议，欢迎提交 Issue 或 Pull Request。

## 致谢

- [月光中心_official](https://space.bilibili.com/25289147) - 攻略制作
- [MskTmi/ElysianRealm-Data](https://github.com/MskTmi/ElysianRealm-Data) - 图片资源
- [AstrBot](https://github.com/Soulter/AstrBot) - 机器人框架

## 许可证

本项目基于 MIT 许可证开源。
